enum Phases {
  PREPAREDNESS
  READINESS
  ACTIVATION
}

model Phase {
  id         Int    @id @default(autoincrement())
  uuid       String @unique @default(uuid())
  name       Phases
  activeYear String

  requiredMandatoryTriggers Int? @default(0)
  requiredOptionalTriggers  Int? @default(0)

  receivedMandatoryTriggers Int? @default(0)
  receivedOptionalTriggers  Int? @default(0)

  canRevert        Boolean @default(false)
  canTriggerPayout Boolean @default(false)
  isActive         Boolean @default(false)
  riverBasin       String

  activatedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime? @updatedAt()

  source   Source     @relation(fields: [riverBasin], references: [riverBasin])
  Trigger  Trigger[]

  @@unique([riverBasin, activeYear, name])
  @@map("tbl_phases")
}

model Trigger {
  id   Int    @id @default(autoincrement())
  uuid String @unique @default(uuid())

  repeatKey   String  @unique
  repeatEvery String?

  triggerStatement Json?   @db.JsonB()
  triggerDocuments Json?   @db.JsonB()
  notes            String?
  title            String?
  description      String?

  phase   Phase?      @relation(fields: [phaseId], references: [uuid])
  phaseId String?
  source  DataSource?

  isMandatory      Boolean @default(false)
  isTriggered      Boolean @default(false)
  isDeleted        Boolean @default(false)
  isDailyMonitored Boolean @default(false)

  createdBy       String?
  triggeredBy     String?
  transactionHash String?

  triggeredAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime? @updatedAt()

  @@map("tbl_triggers")
}